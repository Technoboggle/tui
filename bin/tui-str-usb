#!/bin/bash
#
# Copyright (c) 2014 Simon Arjuna Erat (sea)  <erat.simon@gmail.com>
# All rights reserved.
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>
#
# ------------------------------------------------------------------------
#
#	Variable defaults
#
	script_version=0.2
	ME="$(basename $0)"
	help_text="\r$ME ($script_version)
		\rUsage: $ME [options]
		\rSelect usb device if more than one is found
		\rWhere options are:
		\r\t-h\tThis screen
		\r"
	ARGS=(${@})
	ARGS_COUNT=$#
	targetusb=""
	devDisk=/dev/disk/by-id
	tDev=""
#
#	Load own/users TUI configuration?
#
	source tui
#
#	Variable handling
#
	#[[ -z $1 ]] && echo -e "$help_text" && exit $RET_HELP
	case "$1" in
	"-h")	echo -e "$help_text" ; exit $RET_HELP
		;;
	esac
#
#	Display
#
	if [ "" = "$targetusb" ] ; then
		#tui-title "Please choose the removable media: "
		list="$(ls $devDisk|grep usb|grep -v part)"
		while [ "" = "$list" ] ; do
			left="$BORDER_LEFT Please connect an USB device..."
			right="[  $(tui-indi) ] $BORDER_RIGHT"
			devDisk=/dev/disk/by-id
			printf "\r"
			read -t 1 -p "$left$(getspace $[ $COLUMNS - ${#left} - ${#right} ] )$right"  buffer
			printf "\lf"
			list="$(ls $devDisk|grep usb|grep -v part[0-9])"
		done
		if [ ! "$list" = "$(echo $list)" ]
		then	select targetUsb in $list ; do
				tDev=$(readlink -f $devDisk/$targetUsb)
				break
			done
		else	targetUsb=$list
			tDev=$(readlink -f $devDisk/$targetUsb)
		fi
	else	# Yet to re-impliment
		targetUsb="$(  ls /dev/disk/by-id/ -l | grep $(basename $targetusb)|grep -v part|awk '{print $9}' )"	
		tDev="$targetusb"
	fi
	echo $tDev
